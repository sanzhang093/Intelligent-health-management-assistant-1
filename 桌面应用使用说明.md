# 智能健康管理桌面应用使用说明

## 应用概述

基于tkinter构建的智能健康管理桌面GUI应用，提供原生的桌面窗口界面，支持智能健康问答、症状问诊和健康评估功能。

## 功能特点

### 🎯 核心功能
- **桌面窗口界面**：原生桌面应用，无需浏览器
- **智能问题分类**：自动判断用户问题属于症状问诊还是健康管理场景
- **专业Agent处理**：调用相应的专业Agent提供精准回答
- **个性化服务**：基于用户档案提供个性化健康建议
- **实时交互**：支持连续对话和历史记录查看
- **健康报告生成**：一键生成个性化健康报告

### 🛡️ 容错机制
- **自动降级处理**：当症状问诊Agent不可用时，自动使用健康管理Agent处理
- **网络问题处理**：优雅处理网络连接问题，确保系统可用性
- **错误恢复**：提供重新初始化功能，快速恢复系统状态
- **状态监控**：实时显示系统状态和Agent可用性

## 应用版本

### 标准版 (health_desktop_app.py)
- 完整功能版本
- 需要症状问诊Agent正常工作
- 启动脚本：`start_desktop_app.bat`

### 简化版 (health_desktop_app_2.py)
- 兼容症状问诊Agent不可用的情况
- 自动降级处理机制
- 启动脚本：`start_desktop_app_2.bat`

## 系统要求

### 环境要求
- **Python 3.8+**：必须安装Python 3.8或更高版本
- **tkinter**：Python标准库，通常随Python一起安装
- **网络连接**：用于调用Qwen-Max模型和DashScope API

### 依赖包
- `qwen-agent`：Qwen Agent框架
- `dashscope`：阿里云DashScope SDK
- 其他依赖包会自动从现有项目导入

## 安装和启动

### 1. 环境检查
```bash
# 检查Python版本
python --version

# 检查tkinter是否可用
python -c "import tkinter"
```

### 2. 启动应用

#### 方式1：使用批处理脚本（推荐）
```bash
# 启动标准版
start_desktop_app.bat

# 启动简化版（推荐，兼容性更好）
start_desktop_app_2.bat
```

#### 方式2：直接运行
```bash
# 启动标准版
python src/health_desktop_app.py

# 启动简化版
python src/health_desktop_app_2.py
```

### 3. 应用启动
- 双击批处理文件或运行Python命令
- 桌面窗口会自动弹出并居中显示
- 系统会自动初始化并加载用户数据

## 界面说明

### 主窗口布局
- **标题栏**：显示应用名称和状态指示器
- **左侧面板**：系统设置、用户选择、操作按钮
- **主面板**：对话历史、问题输入区域
- **状态栏**：显示当前状态和用户信息

### 左侧面板功能
1. **用户选择**：下拉选择用户ID（100个用户可选）
2. **用户信息查看**：显示选中用户的详细健康档案
3. **问题类型选择**：自动判断/症状问诊/健康管理
4. **操作按钮**：生成报告、清空历史、导出记录、重新初始化
5. **系统信息**：显示系统状态和Agent可用性

### 主面板功能
1. **对话历史**：显示所有问答记录，支持滚动查看
2. **问题输入**：多行文本输入框，支持长文本输入
3. **提交按钮**：提交问题并获取回答

## 使用指南

### 1. 系统初始化
- 首次启动时，系统会自动初始化
- 初始化过程包括加载用户数据和Agent
- 如果症状问诊Agent初始化失败，系统会显示警告并继续运行

### 2. 用户选择
- 在左侧面板选择用户ID
- 系统会显示100个可用用户（user_001 到 user_100）
- 选择用户后可以查看用户详细信息

### 3. 健康问答
- 在问题输入框中输入您的健康问题
- 选择问题类型（自动判断/症状问诊/健康管理）
- 点击"提交问题"按钮获取回答

### 4. 问题类型说明

#### 自动判断
- 系统使用Qwen-Max模型自动分析问题类型
- 根据问题内容判断属于症状问诊还是健康管理
- 推荐使用此选项

#### 症状问诊
- 适用于具体症状描述、疾病咨询、用药问题等
- 如果症状问诊Agent不可用，会自动使用健康管理Agent处理
- 系统会显示降级处理提示

#### 健康管理
- 适用于健康趋势分析、生活方式改善、健康规划等
- 直接调用健康管理Agent处理

### 5. 健康报告生成
- 点击"生成健康报告"按钮
- 系统会生成个性化的健康管理报告
- 支持预览和另存为功能

### 6. 对话历史管理
- 系统会保存所有对话历史
- 支持清空历史记录
- 可以导出对话记录为文本文件

## 界面操作

### 基本操作
- **选择用户**：点击下拉框选择用户ID
- **输入问题**：在文本框中输入健康问题
- **提交问题**：点击"提交问题"按钮
- **查看回答**：在对话历史区域查看回答

### 高级操作
- **查看用户信息**：选择用户后点击"查看用户信息"按钮
- **生成健康报告**：点击"生成健康报告"按钮
- **导出对话记录**：点击"导出记录"按钮
- **清空历史**：点击"清空历史"按钮
- **重新初始化**：点击"重新初始化"按钮

### 窗口操作
- **调整大小**：拖拽窗口边缘调整大小
- **最小化**：点击最小化按钮
- **关闭**：点击关闭按钮或按Alt+F4

## 状态指示

### 系统状态
- **🔄 正在初始化**：系统启动中
- **✅ 系统初始化完成**：所有功能正常
- **⚠️ 系统初始化完成（症状问诊Agent不可用）**：部分功能受限
- **❌ 初始化失败**：系统启动失败

### Agent状态
- **✅ 症状问诊Agent: 可用**：症状问诊功能正常
- **⚠️ 症状问诊Agent: 不可用**：症状问诊功能受限

### 处理状态
- **🤖 正在分析问题**：问题处理中
- **📊 正在生成健康报告**：报告生成中
- **✅ 问题处理完成**：处理成功
- **❌ 处理失败**：处理出错

## 常见问题

### Q1: 应用无法启动怎么办？
**A**: 检查Python是否正确安装，确保Python版本为3.8或更高。

### Q2: 症状问诊Agent不可用怎么办？
**A**: 使用简化版应用（health_desktop_app_2.py），它会自动使用健康管理Agent处理所有问题。

### Q3: 如何查看用户信息？
**A**: 在左侧面板选择用户后，点击"查看用户信息"按钮。

### Q4: 如何导出对话记录？
**A**: 点击左侧面板的"导出记录"按钮，选择保存位置。

### Q5: 系统响应慢怎么办？
**A**: 检查网络连接，确保DashScope API密钥有效。可以尝试重新初始化系统。

### Q6: 如何重新初始化系统？
**A**: 点击左侧面板的"重新初始化"按钮。

### Q7: 窗口无法显示怎么办？
**A**: 检查显示器设置，确保窗口没有超出屏幕范围。可以尝试重新启动应用。

## 技术特点

### 1. 原生桌面应用
- 基于tkinter构建，无需浏览器
- 原生窗口界面，响应速度快
- 支持窗口操作（最小化、最大化、关闭）

### 2. 多线程处理
- 后台线程处理AI请求，避免界面卡顿
- 实时状态更新和进度显示
- 异步处理提高用户体验

### 3. 容错机制
- 完善的错误处理和恢复机制
- 自动降级处理确保系统可用性
- 友好的错误提示和操作指导

### 4. 数据管理
- 本地数据存储，保护用户隐私
- 支持对话记录导出
- 支持健康报告保存

## 安全说明

### 数据安全
- 所有用户数据存储在本地
- 对话历史仅在会话期间保存
- 支持手动清空历史记录

### 医疗免责
- 本系统仅供参考，不能替代专业医疗诊断
- 如有紧急情况请及时就医
- 系统建议不构成医疗建议

## 更新日志

### v1.0.0 (2024年)
- 初始版本发布
- 支持桌面窗口界面
- 支持智能问题分类
- 支持症状问诊和健康管理
- 支持健康报告生成
- 支持对话历史管理
- 支持自动降级处理

## 技术支持

如遇到问题，请检查：
1. Python版本是否为3.8或更高
2. 网络连接是否正常
3. DashScope API密钥是否有效
4. 用户数据文件是否存在
5. 显示器设置是否正常

---

**版本**: 1.0.0  
**更新时间**: 2024年  
**技术支持**: AI Assistant
