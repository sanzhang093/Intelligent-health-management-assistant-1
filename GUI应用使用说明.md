# 智能健康管理GUI应用使用说明

## 应用概述

基于Streamlit构建的智能健康管理GUI前端应用，提供用户友好的Web界面，支持智能健康问答、症状问诊和健康评估功能。

## 功能特点

### 🎯 核心功能
- **智能问题分类**：自动判断用户问题属于症状问诊还是健康管理场景
- **专业Agent处理**：调用相应的专业Agent提供精准回答
- **个性化服务**：基于用户档案提供个性化健康建议
- **实时交互**：支持连续对话和历史记录查看
- **健康报告生成**：一键生成个性化健康报告

### 🛡️ 容错机制
- **自动降级处理**：当症状问诊Agent不可用时，自动使用健康管理Agent处理
- **网络问题处理**：优雅处理网络连接问题，确保系统可用性
- **错误恢复**：提供重新初始化功能，快速恢复系统状态

## 应用版本

### 标准版 (health_gui_app.py)
- 完整功能版本
- 需要症状问诊Agent正常工作
- 端口：8501

### 简化版 (health_gui_app_2.py)
- 兼容症状问诊Agent不可用的情况
- 自动降级处理机制
- 端口：8502

## 安装和启动

### 1. 环境准备
```bash
# 安装依赖包
pip install -r requirements_gui.txt

# 或者手动安装
pip install streamlit pandas qwen-agent dashscope
```

### 2. 启动应用

#### 方式1：使用批处理脚本
```bash
# 启动标准版
start_gui_app.bat

# 启动简化版
start_gui_app_2.bat
```

#### 方式2：直接运行
```bash
# 启动标准版
streamlit run src/health_gui_app.py --server.port 8501

# 启动简化版
streamlit run src/health_gui_app_2.py --server.port 8502
```

### 3. 访问应用
- 标准版：http://localhost:8501
- 简化版：http://localhost:8502

## 使用指南

### 1. 系统初始化
- 首次启动时，系统会自动初始化
- 初始化过程包括加载用户数据和Agent
- 如果症状问诊Agent初始化失败，系统会显示警告并继续运行

### 2. 用户选择
- 在左侧边栏选择用户ID
- 系统会显示100个可用用户（user_001 到 user_100）
- 选择用户后可以查看用户详细信息

### 3. 健康问答
- 在问题输入框中输入您的健康问题
- 选择问题类型（自动判断/症状问诊/健康管理）
- 点击"提交问题"按钮获取回答

### 4. 问题类型说明

#### 自动判断
- 系统使用Qwen-Max模型自动分析问题类型
- 根据问题内容判断属于症状问诊还是健康管理
- 推荐使用此选项

#### 症状问诊
- 适用于具体症状描述、疾病咨询、用药问题等
- 如果症状问诊Agent不可用，会自动使用健康管理Agent处理

#### 健康管理
- 适用于健康趋势分析、生活方式改善、健康规划等
- 直接调用健康管理Agent处理

### 5. 健康报告生成
- 点击"生成健康报告"按钮
- 系统会生成个性化的健康管理报告
- 支持预览和下载功能

### 6. 对话历史
- 系统会保存所有对话历史
- 支持查看历史对话记录
- 可以导出对话记录为CSV文件

## 界面说明

### 主界面布局
- **顶部**：系统标题和功能说明
- **左侧边栏**：用户选择、系统信息、操作按钮
- **主区域**：对话历史、问题输入、结果展示
- **底部**：系统信息和免责声明

### 状态指示
- **绿色**：系统正常，所有功能可用
- **黄色**：部分功能受限，但系统可用
- **红色**：系统错误，需要检查配置

## 常见问题

### Q1: 症状问诊Agent初始化失败怎么办？
**A**: 使用简化版应用（health_gui_app_2.py），它会自动使用健康管理Agent处理所有问题。

### Q2: 如何查看用户信息？
**A**: 在左侧边栏选择用户后，点击"查看用户信息"按钮。

### Q3: 如何导出对话记录？
**A**: 在左侧边栏点击"导出对话记录"按钮，系统会生成CSV文件供下载。

### Q4: 系统响应慢怎么办？
**A**: 检查网络连接，确保DashScope API密钥有效。可以尝试重新初始化系统。

### Q5: 如何重新初始化系统？
**A**: 在左侧边栏点击"重新初始化系统"按钮。

## 技术架构

### 前端技术
- **Streamlit**：Web应用框架
- **Pandas**：数据处理
- **HTML/CSS**：界面样式

### 后端技术
- **main_choice.py**：主控制器
- **health_ask_quickly.py**：症状问诊Agent
- **health_management_agent_enhanced.py**：健康管理Agent
- **Qwen-Max**：AI模型

### 数据存储
- **用户档案**：data/profiles/ 目录
- **健康报告**：reports/ 目录
- **对话历史**：内存存储，支持导出

## 安全说明

### 数据安全
- 所有用户数据存储在本地
- 对话历史仅在会话期间保存
- 支持手动清空历史记录

### 医疗免责
- 本系统仅供参考，不能替代专业医疗诊断
- 如有紧急情况请及时就医
- 系统建议不构成医疗建议

## 更新日志

### v1.0.0 (2024年)
- 初始版本发布
- 支持智能问题分类
- 支持症状问诊和健康管理
- 支持健康报告生成
- 支持对话历史管理

## 技术支持

如遇到问题，请检查：
1. 网络连接是否正常
2. DashScope API密钥是否有效
3. 依赖包是否正确安装
4. 用户数据文件是否存在

---

**版本**: 1.0.0  
**更新时间**: 2024年  
**技术支持**: AI Assistant
